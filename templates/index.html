<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Restaurant AI Marketing Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes highlight-fade {
      0% { background-color: rgba(255, 255, 0, 0.5); }
      100% { background-color: transparent; }
    }
    .highlight {
      animation: highlight-fade 1.5s ease-out;
    }
  </style>
</head>
  <body class="bg-gray-100 p-8" onload="showTab('{{ active_tab | default('sales') }}', null)">
  <div class="text-center mb-8">
    <h1 class="text-4xl font-bold">Restaurant AI Marketing Assistant</h1>
    <p class="text-lg text-gray-600">Generate Instagram content based on sales data, weather, and holidays</p>
  </div>

  <!-- Tabs -->
  <div class="mb-6 flex justify-center space-x-2">
    <button class="tab-button text-blue-600 border-b-2 border-blue-600 font-semibold px-4 py-2" onclick="showTab('sales', this)">Sales-Based Content</button>
    <button class="tab-button text-gray-700 border-b-2 border-transparent px-4 py-2" onclick="showTab('weather', this)">Weather-Based Content</button>
    <button class="tab-button text-gray-700 border-b-2 border-transparent px-4 py-2" onclick="showTab('holiday', this)">Holiday-Based Content</button>
  </div>

  <!-- Sales Tab -->
  <div id="tab-sales" class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="bg-white p-6 rounded-xl shadow flex flex-col justify-between">
      <div>
        <h2 class="text-xl font-bold mb-4">🔥 Top 5 Dishes (Yesterday)</h2>
        {% for dish in dishes %}<div class="mb-2">• {{ dish.name }} — Sold: {{ dish.sold }}</div>{% endfor %}
      </div>
      <form action="/update-top-dishes" method="post" class="mt-4">
        <input type="hidden" name="caption" value="{{ caption }}">
        <input type="hidden" name="image_url" value="{{ image_url }}">
        <input type="hidden" name="weather_info" value="{{ weather_info }}">
        <input type="hidden" name="weather_caption" value="{{ weather_caption }}">
        <input type="hidden" name="weather_image_url" value="{{ weather_image_url }}">
        <input type="hidden" name="holiday_caption" value="{{ holiday_caption }}">
        <input type="hidden" name="holiday_message" value="{{ holiday_message }}">
        <input type="hidden" name="holiday_image_url" value="{{ holiday_image_url }}">
        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
          🔄 Refresh Sales Data
        </button>
      </form>
    </div>

    <div class="bg-white p-6 rounded-xl shadow flex flex-col justify-between">
      <div>
        <h2 class="text-xl font-bold mb-4">📝 AI Generated Caption</h2>
        <p id="caption-text" class="{{ 'highlight' if highlight_caption }}">{{ caption }}</p>
      </div>
      <form action="/regenerate-caption" method="post" class="mt-4">
        <input type="hidden" name="image_url" value="{{ image_url }}">
        <input type="hidden" name="weather_info" value="{{ weather_info }}">
        <input type="hidden" name="weather_caption" value="{{ weather_caption }}">
        <button class="w-full bg-blue-700 text-white px-4 py-2 rounded">🔁 Regenerate Caption</button>
      </form>
    </div>

    <div class="bg-white p-6 rounded-xl shadow flex flex-col justify-between">
      <div>
        <h2 class="text-xl font-bold mb-4">📸 AI Generated Image</h2>
        {% if image_url and image_url != "None" %}
          <img src="{{ image_url }}" id="sales-image" class="rounded-md mb-2 {{ 'highlight' if highlight_image }}">
        {% else %}
          <p class="text-gray-500">Image not generated yet. Click below to generate.</p>
        {% endif %}
      </div>
      <form action="/regenerate-image" method="post" class="mt-4">
        <input type="hidden" name="caption" value="{{ caption }}">
        <input type="hidden" name="weather_info" value="{{ weather_info }}">
        <input type="hidden" name="weather_caption" value="{{ weather_caption }}">
        <button class="w-full bg-blue-700 text-white px-4 py-2 rounded">🖼️ Generate Image Now</button>
      </form>
    </div>

    <!-- Post to Instagram Button -->
    <div class="col-span-1 md:col-span-3 flex justify-center">
      <form action="/post-to-instagram" method="post" class="mt-4">
        <input type="hidden" name="caption" value="{{ caption }}">
        <input type="hidden" name="image_url" value="{{ image_url }}">
        <button class="bg-pink-600 hover:bg-pink-700 text-white px-6 py-2 rounded shadow">📤 Post to Instagram</button>
      </form>
    </div>
  </div>

    <!-- Weather Tab -->
    <div id="tab-weather" class="hidden grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- Weather Info Card -->
      <div class="bg-white p-6 rounded-xl shadow flex flex-col justify-between">
        <div>
          <h2 class="text-xl font-bold mb-4">🌤️ Tomorrow's Weather</h2>
          <p>{{ weather_info }}</p>
        </div>
        <form action="/refresh-weather" method="post" class="mt-4">
          <input type="hidden" name="caption" value="{{ caption }}">
          <input type="hidden" name="image_url" value="{{ image_url }}">
          <input type="hidden" name="weather_caption" value="{{ weather_caption }}">
          <input type="hidden" name="weather_image_url" value="{{ weather_image_url }}">
          <input type="hidden" name="holiday_caption" value="{{ holiday_caption }}">
          <input type="hidden" name="holiday_message" value="{{ holiday_message }}">
          <input type="hidden" name="holiday_image_url" value="{{ holiday_image_url }}">
          <button class="w-full bg-blue-700 text-white px-4 py-2 rounded">🔄 Refresh Weather</button>
        </form>
      </div>

      <!-- Weather Caption Card -->
      <div class="bg-white p-6 rounded-xl shadow flex flex-col justify-between">
        <div>
          <h2 class="text-xl font-bold mb-4">📝 AI Caption Based on Weather</h2>
          <p id="weather-caption-text" class="{{ 'highlight' if highlight_weather_caption }}">{{ weather_caption }}</p>
        </div>
        <form action="/weather-caption" method="post" class="mt-4">
          <input type="hidden" name="caption" value="{{ caption }}">
          <input type="hidden" name="image_url" value="{{ image_url }}">
          <input type="hidden" name="weather_info" value="{{ weather_info }}">
          <button class="w-full bg-blue-700 text-white px-4 py-2 rounded">🔁 Regenerate Caption by Weather</button>
        </form>
      </div>

      <!-- Weather Image Card -->
      <div class="bg-white p-6 rounded-xl shadow flex flex-col justify-between">
        <div>
          <h2 class="text-xl font-bold mb-4">🌦️ AI Image Based on Weather</h2>
          {% if weather_image_url and weather_image_url != "None" %}
            <img src="{{ weather_image_url }}" id="weather-image" class="rounded-md mb-2 {{ 'highlight' if highlight_weather_image }}">
          {% else %}
            <p class="text-gray-500">Weather image not generated yet.</p>
          {% endif %}
        </div>
        <form action="/regenerate-weather-image" method="post" class="mt-4">
          <input type="hidden" name="caption" value="{{ caption }}">
          <input type="hidden" name="image_url" value="{{ image_url }}">
          <input type="hidden" name="weather_info" value="{{ weather_info }}">
          <input type="hidden" name="weather_caption" value="{{ weather_caption }}">
          <button class="w-full bg-blue-700 text-white px-4 py-2 rounded">🌧️ Generate Image</button>
        </form>
      </div>

      <!-- Post to Instagram -->
      <div class="col-span-1 md:col-span-3 flex justify-center">
        <form action="/post-weather-to-instagram" method="post" class="mt-4">
          <input type="hidden" name="caption" value="{{ weather_caption }}">
          <input type="hidden" name="image_url" value="{{ weather_image_url }}">
          <button class="bg-pink-600 hover:bg-pink-700 text-white px-6 py-2 rounded shadow">📤 Post to Instagram</button>
        </form>
      </div>
    </div>

    <!-- Holiday Tab -->
    <div id="tab-holiday" class="hidden grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- Holiday Info -->
      <div class="bg-white p-6 rounded-xl shadow flex flex-col justify-between">
        <div>
          <h2 class="text-xl font-bold mb-4">🎊 Tomorrow's Holiday</h2>
          <p>{{ holiday_message }}</p>
        </div>
        <form action="/refresh-holiday" method="post" class="mt-4">
          <input type="hidden" name="caption" value="{{ caption }}">
          <input type="hidden" name="image_url" value="{{ image_url }}">
          <input type="hidden" name="weather_info" value="{{ weather_info }}">
          <input type="hidden" name="weather_caption" value="{{ weather_caption }}">
          <input type="hidden" name="weather_image_url" value="{{ weather_image_url }}">
          <input type="hidden" name="holiday_caption" value="{{ holiday_caption }}">
          <input type="hidden" name="holiday_image_url" value="{{ holiday_image_url }}">
          <button class="w-full bg-blue-700 text-white px-4 py-2 rounded">🔄 Refresh Holiday</button>
        </form>
      </div>

      <!-- Holiday Caption -->
      <div class="bg-white p-6 rounded-xl shadow flex flex-col justify-between">
        <div>
          <h2 class="text-xl font-bold mb-4">📝 AI Caption Based on Holiday</h2>
          {% if holiday_caption %}
            <p id="holiday-caption-text" class="{{ 'highlight' if highlight_holiday_caption }}">{{ holiday_caption }}</p>
          {% else %}
            <p class="text-gray-500">No holiday caption available.</p>
          {% endif %}
        </div>
        <form action="/regenerate-holiday-caption" method="post" class="mt-4">
          <input type="hidden" name="caption" value="{{ caption }}">
          <input type="hidden" name="image_url" value="{{ image_url }}">
          <input type="hidden" name="weather_info" value="{{ weather_info }}">
          <input type="hidden" name="weather_caption" value="{{ weather_caption }}">
          <input type="hidden" name="holiday_message" value="{{ holiday_message }}">
          <button class="w-full bg-blue-700 text-white px-4 py-2 rounded">🔁 Regenerate Holiday Caption</button>
        </form>
      </div>

      <!-- Holiday Image -->
      <div class="bg-white p-6 rounded-xl shadow flex flex-col justify-between">
        <div>
          <h2 class="text-xl font-bold mb-4">📸 AI Image Based on Holiday</h2>
          {% if holiday_image_url and holiday_image_url != "None" %}
            <img src="{{ holiday_image_url }}" id="holiday-image" class="rounded-md mb-2 {{ 'highlight' if highlight_holiday_image }}">
          {% else %}
            <p class="text-gray-500">Holiday image not generated yet.</p>
          {% endif %}
        </div>
        <form action="/regenerate-holiday-image" method="post" class="mt-4">
          <input type="hidden" name="caption" value="{{ caption }}">
          <input type="hidden" name="image_url" value="{{ image_url }}">
          <input type="hidden" name="weather_info" value="{{ weather_info }}">
          <input type="hidden" name="weather_caption" value="{{ weather_caption }}">
          <input type="hidden" name="holiday_caption" value="{{ holiday_caption }}">
          <button class="w-full bg-blue-700 text-white px-4 py-2 rounded">📅 Generate Holiday Image</button>
        </form>
      </div>

      <!-- Post to Instagram -->
      <div class="col-span-1 md:col-span-3 flex justify-center">
        <form action="/post-holiday-to-instagram" method="post" class="mt-4">
          <input type="hidden" name="caption" value="{{ holiday_caption }}">
          <input type="hidden" name="image_url" value="{{ holiday_image_url }}">
          <button class="bg-pink-600 hover:bg-pink-700 text-white px-6 py-2 rounded shadow">📤 Post to Instagram</button>
        </form>
      </div>
    </div>

  <script>
    function showTab(tab, clickedBtn) {
      document.querySelectorAll('[id^="tab-"]').forEach(el => el.classList.add('hidden'));
      document.getElementById('tab-' + tab).classList.remove('hidden');

      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('text-blue-600', 'border-blue-600', 'font-semibold');
        btn.classList.add('text-gray-700', 'border-transparent');
      });

      if (clickedBtn) {
        clickedBtn.classList.add('text-blue-600', 'border-blue-600', 'font-semibold');
        clickedBtn.classList.remove('text-gray-700', 'border-transparent');
      } else {
        // 页面加载时，根据 tab 名称自动高亮按钮
        const index = { sales: 0, weather: 1, holiday: 2 }[tab] || 0;
        const defaultBtn = document.querySelectorAll('.tab-button')[index];
        if (defaultBtn) {
          defaultBtn.classList.add('text-blue-600', 'border-blue-600', 'font-semibold');
          defaultBtn.classList.remove('text-gray-700', 'border-transparent');
        }
      }
    }
  </script>
</body>
</html>